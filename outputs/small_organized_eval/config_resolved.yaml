paths:
  checkpoint_path: null
  base_experiment_log_dir: <YOUR EXPERIMENET LOG_DIR>
  base_annotation_path: <YOUR_GOLD_GT_DIR>
  base_annotation_path_silver: <YOUR_SILVER_GT_DIR>
  metaclip_img_path: <YOUR_METACLIP_IMG_DIR>
  sa1b_img_path: <YOUR_SA1B_IMG_DIR>
  silver_img_path: <YOUR_SILVER_IMG_DIR>
  bpe_path: /home/daizi/sam3/sam3/assets/bpe_simple_vocab_16e6.txt.gz
  experiment_log_dir: /home/daizi/sam3/outputs/small_organized_eval
  coco_gt: /home/daizi/sam3/img/small_organized/coco/annotations.json
  img_path: /home/daizi/sam3/img/small_organized/rgb
scratch:
  use_presence_eval: false
  base_val_transform:
  - _target_: sam3.train.transforms.basic_for_api.ComposeAPI
    transforms:
    - _target_: sam3.train.transforms.basic_for_api.RandomResizeAPI
      sizes: 1008
      max_size:
        _target_: sam3.train.transforms.basic.get_random_resize_max_size
        size: 1008
      square: true
      consistent_transform: false
    - _target_: sam3.train.transforms.basic_for_api.ToTensorAPI
    - _target_: sam3.train.transforms.basic_for_api.NormalizeAPI
      mean:
      - 0.5
      - 0.5
      - 0.5
      std:
      - 0.5
      - 0.5
      - 0.5
  loss: null
  d_model: 256
  input_box_embedding_dim: 258
  original_box_postprocessor:
    _target_: sam3.eval.postprocessors.PostProcessImage
    max_dets_per_img: -1
    use_original_ids: true
    use_original_sizes_box: true
    use_presence: false
  box_postprocessor:
    _target_: sam3.eval.postprocessors.PostProcessImage
    max_dets_per_img: -1
    use_original_ids: false
    use_original_sizes_box: false
    use_presence: false
  box_postprocessor_thresholded:
    _target_: sam3.eval.postprocessors.PostProcessImage
    max_dets_per_img: -1
    use_original_ids: false
    use_original_sizes_box: false
    detection_threshold: 0.3
    use_presence: false
  mask_postprocessor_thresholded:
    _target_: sam3.eval.postprocessors.PostProcessImage
    max_dets_per_img: -1
    iou_type: segm
    use_original_ids: false
    use_original_sizes_box: false
    use_original_sizes_mask: true
    convert_mask_to_rle: true
    detection_threshold: 0.3
    use_presence: false
    always_interpolate_masks_on_gpu: false
  resolution: 1008
  max_ann_per_img: 200
  train_norm_mean:
  - 0.5
  - 0.5
  - 0.5
  train_norm_std:
  - 0.5
  - 0.5
  - 0.5
  val_norm_mean:
  - 0.5
  - 0.5
  - 0.5
  val_norm_std:
  - 0.5
  - 0.5
  - 0.5
  train_batch_size: 1
  val_batch_size: 1
  num_train_workers: 0
  num_val_workers: 10
  max_data_epochs: 20
  target_epoch_size: 1500
  hybrid_repeats: 1
  context_length: 2
  gather_pred_via_filesys: false
  lr_scale: 0.1
  lr_transformer: 8.0e-05
  lr_vision_backbone: 2.5e-05
  lr_language_backbone: 5.0e-06
  lrd_vision_backbone: 0.9
  wd: 0.1
  scheduler_timescale: 20
  scheduler_warmup: 20
  scheduler_cooldown: 20
trainer:
  _target_: sam3.train.trainer.Trainer
  skip_saving_ckpts: true
  empty_gpu_mem_cache_after_eval: true
  skip_first_val: true
  max_epochs: 20
  accelerator: cpu
  seed_value: 123
  val_epoch_freq: 10
  mode: val
  distributed:
    backend: gloo
    find_unused_parameters: true
    gradient_as_bucket_view: true
  loss:
    all:
      _target_: sam3.train.loss.sam3_loss.DummyLoss
    default:
      _target_: sam3.train.loss.sam3_loss.DummyLoss
  data:
    train: null
    val:
      _target_: sam3.train.data.torch_dataset.TorchDataset
      dataset:
        _target_: sam3.train.data.sam3_image_dataset.Sam3ImageDataset
        coco_json_loader:
          _target_: sam3.train.data.coco_json_loaders.COCO_FROM_JSON
          include_negatives: true
          category_chunk_size: 8
          _partial_: true
        img_folder: /home/daizi/sam3/img/small_organized/rgb
        ann_file: /home/daizi/sam3/img/small_organized/coco/annotations.json
        transforms:
        - _target_: sam3.train.transforms.basic_for_api.ComposeAPI
          transforms:
          - _target_: sam3.train.transforms.basic_for_api.RandomResizeAPI
            sizes: 1008
            max_size:
              _target_: sam3.train.transforms.basic.get_random_resize_max_size
              size: 1008
            square: true
            consistent_transform: false
          - _target_: sam3.train.transforms.basic_for_api.ToTensorAPI
          - _target_: sam3.train.transforms.basic_for_api.NormalizeAPI
            mean:
            - 0.5
            - 0.5
            - 0.5
            std:
            - 0.5
            - 0.5
            - 0.5
        max_ann_per_img: 100000
        multiplier: 1
        training: false
      shuffle: false
      batch_size: 1
      num_workers: 0
      pin_memory: false
      drop_last: false
      collate_fn:
        _target_: sam3.train.data.collator.collate_fn_api
        _partial_: true
        repeats: 1
        dict_key: small_coco
  model:
    _target_: sam3.model_builder.build_sam3_image_model
    bpe_path: /home/daizi/sam3/sam3/assets/bpe_simple_vocab_16e6.txt.gz
    device: cpus
    eval_mode: true
    enable_segmentation: true
    checkpoint_path: null
  meters:
    val:
      small_coco:
        bbox:
          _target_: sam3.eval.coco_writer.PredictionDumper
          iou_type: bbox
          dump_dir: /home/daizi/sam3/outputs/small_organized_eval/dumps/small_coco
          merge_predictions: true
          postprocessor:
            _target_: sam3.eval.postprocessors.PostProcessImage
            max_dets_per_img: -1
            use_original_ids: true
            use_original_sizes_box: true
            use_presence: false
          maxdets: 100
          pred_file_evaluators:
          - _target_: sam3.eval.coco_eval_offline.CocoEvaluatorOfflineWithPredFileEvaluators
            gt_path: /home/daizi/sam3/img/small_organized/coco/annotations.json
            tide: false
            iou_type: bbox
        segm:
          _target_: sam3.eval.coco_writer.PredictionDumper
          iou_type: segm
          dump_dir: /home/daizi/sam3/outputs/small_organized_eval/dumps/small_coco
          merge_predictions: true
          postprocessor:
            _target_: sam3.eval.postprocessors.PostProcessImage
            max_dets_per_img: -1
            iou_type: segm
            use_original_ids: false
            use_original_sizes_box: false
            use_original_sizes_mask: true
            convert_mask_to_rle: true
            detection_threshold: 0.3
            use_presence: false
            always_interpolate_masks_on_gpu: false
          maxdets: 100
          pred_file_evaluators:
          - _target_: sam3.eval.coco_eval_offline.CocoEvaluatorOfflineWithPredFileEvaluators
            gt_path: /home/daizi/sam3/img/small_organized/coco/annotations.json
            tide: false
            iou_type: segm
          - _target_: sam3.eval.per_image_mask_metrics_fast.PerImageMaskMetricsFastEvaluator
            gt_path: /home/daizi/sam3/img/small_organized/coco/annotations.json
            iou_type: segm
            threshold: 0.5
            confidence_thresholds:
            - 0.4
            - 0.45
            - 0.5
            - 0.55
            - 0.6
            - 0.65
            - 0.7
            - 0.75
            - 0.8
            - 0.85
            - 0.9
            - 0.95
            boundary_rel_tolerances:
            - 0.001
            - 0.002
            - 0.003
            - 0.004
            - 0.005
            num_workers: null
            chunk_size: 8
            output_json: /home/daizi/sam3/outputs/small_organized_eval/dumps/small_coco/per_image_metrics_segm.json
            output_csv: /home/daizi/sam3/outputs/small_organized_eval/dumps/small_coco/per_image_metrics_segm.csv
  optim:
    amp:
      enabled: false
      amp_dtype: bfloat16
    optimizer:
      _target_: torch.optim.AdamW
    gradient_clip:
      _target_: sam3.train.optim.optimizer.GradientClipper
      max_norm: 0.1
      norm_type: 2
    param_group_modifiers:
    - _target_: sam3.train.optim.optimizer.layer_decay_param_modifier
      _partial_: true
      layer_decay_value: 0.9
      apply_to: backbone.vision_backbone.trunk
      overrides:
      - pattern: '*pos_embed*'
        value: 1.0
    options:
      lr:
      - scheduler:
          _target_: sam3.train.optim.schedulers.InverseSquareRootParamScheduler
          base_lr: 8.0e-05
          timescale: 20
          warmup_steps: 20
          cooldown_steps: 20
      - scheduler:
          _target_: sam3.train.optim.schedulers.InverseSquareRootParamScheduler
          base_lr: 2.5e-05
          timescale: 20
          warmup_steps: 20
          cooldown_steps: 20
        param_names:
        - backbone.vision_backbone.*
      - scheduler:
          _target_: sam3.train.optim.schedulers.InverseSquareRootParamScheduler
          base_lr: 5.0e-06
          timescale: 20
          warmup_steps: 20
          cooldown_steps: 20
        param_names:
        - backbone.language_backbone.*
      weight_decay:
      - scheduler:
          _target_: fvcore.common.param_scheduler.ConstantParamScheduler
          value: 0.1
      - scheduler:
          _target_: fvcore.common.param_scheduler.ConstantParamScheduler
          value: 0.0
        param_names:
        - '*bias*'
        module_cls_names:
        - torch.nn.LayerNorm
  checkpoint:
    save_dir: /home/daizi/sam3/outputs/small_organized_eval/checkpoints
    save_freq: 0
  logging:
    tensorboard_writer:
      _target_: sam3.train.utils.logger.make_tensorboard_logger
      log_dir: /home/daizi/sam3/outputs/small_organized_eval/tensorboard
      flush_secs: 120
      should_log: true
    wandb_writer: null
    log_dir: /home/daizi/sam3/outputs/small_organized_eval/logs/
    log_freq: 10
launcher:
  num_nodes: 1
  gpus_per_node: 1
  experiment_log_dir: /home/daizi/sam3/outputs/small_organized_eval
  multiprocessing_context: forkserver
submitit:
  account: null
  partition: null
  qos: null
  timeout_hour: 72
  use_cluster: false
  cpus_per_task: 10
  port_range:
  - 10000
  - 65000
  constraint: null
